<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using the iso8601 functions • dataCleanr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using the iso8601 functions">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dataCleanr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/iso8601_functions.html">Using the iso8601 functions</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/EDIorg/dataCleanr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Using the iso8601 functions</h1>
                        <h4 class="author">Colin Smith</h4>
            
            <h4 class="date">2019-02-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/EDIorg/dataCleanr/blob/master/vignettes/iso8601_functions.Rmd"><code>vignettes/iso8601_functions.Rmd</code></a></small>
      <div class="hidden name"><code>iso8601_functions.Rmd</code></div>

    </div>

    
    
<p>Data interoperability is improved by the adoption of standard date and time formats. To facilitate use of the ISO 8601 standard, we’ve developed functions for converting to a subset of ISO 8601 formats, for reporting ISO 8601 format specifiers, and for reading ISO 8601 into R as POSIXct and POSIXt. This vignette provides an overview of these functions and demonstrates their capabilities.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Install and load dataCleanr</span>

<span class="co"># devtools::install_github('EDIorg/dataCleanr')</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dataCleanr)</code></pre></div>
<div id="conversion" class="section level2">
<h2 class="hasAnchor">
<a href="#conversion" class="anchor"></a>Conversion</h2>
<p><code>iso8601_convert</code> converts date and time character strings to the standard ISO 8601 format, with the output resolution matching the input resolution, and full support of timezone offsets. This function does not convert to all ISO 8601 formats. Currently supported formats include calendar dates, times, time zones, and valid combinations of these. Week dates, ordinal dates, and time intervals are not yet supported.</p>
<p><code>iso8601_convert</code> leverages the power of <code><a href="http://lubridate.tidyverse.org/reference/parse_date_time.html">lubridate::parse_date_time</a></code> to parse dates and times, then uses regular expressions on the user supplied <code>orders</code> argument to identify resolution of the input data, and then outputs the converted data in this same resolution. Most of the arguments available to <code><a href="http://lubridate.tidyverse.org/reference/parse_date_time.html">lubridate::parse_date_time</a></code> can be used with <code>iso8601_convert</code>.</p>
<p>A common data management issue is converting date and time data into a consistent format. The following example illustrates some issues encountered in this process and how to solve them with <code>iso8601_convert</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load the example data and view the first few lines to identify datetime orders</span>

x &lt;-<span class="st"> </span>data_iso8601<span class="op">$</span>datetime
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(x)
<span class="co">#&gt; [1] "5/15/12 13:00" "5/15/12 14:00" "5/15/12 15:00" "5/15/12 16:00"</span>
<span class="co">#&gt; [5] "5/15/12 17:00" "5/15/12 18:00"</span>

<span class="co"># Convert the data using 'mdy HM' orders</span>

x_cnv &lt;-<span class="st"> </span><span class="kw"><a href="../reference/iso8601_convert.html">iso8601_convert</a></span>(x, <span class="dt">orders =</span> <span class="st">'mdy HM'</span>)
<span class="co">#&gt; Warning in iso8601_convert(x, orders = "mdy HM"): Some data failed to</span>
<span class="co">#&gt; parse. Consider updating your list of orders.</span>
x_cnv
<span class="co">#&gt;  [1] "2012-05-15T13:00" "2012-05-15T14:00" "2012-05-15T15:00"</span>
<span class="co">#&gt;  [4] "2012-05-15T16:00" "2012-05-15T17:00" "2012-05-15T18:00"</span>
<span class="co">#&gt;  [7] "2012-05-15T19:00" "2012-05-15T20:00" "2012-05-15T21:00"</span>
<span class="co">#&gt; [10] "2012-05-15T22:00" "2012-05-15T23:00" "2012-05-16T00:00"</span>
<span class="co">#&gt; [13] NA                 NA                 NA                </span>
<span class="co">#&gt; [16] NA                 NA                 "2012-05-16T06:00"</span>
<span class="co">#&gt; [19] "2012-05-16T07:00" "2012-05-16T08:00" "2012-05-16T09:00"</span>
<span class="co">#&gt; [22] NA                 NA                 NA                </span>
<span class="co">#&gt; [25] NA                 NA                 NA                </span>
<span class="co">#&gt; [28] NA                 NA                 NA                </span>
<span class="co">#&gt; [31] NA</span></code></pre></div>
<p>Looks like the orders didn’t fully describe the input data. NAs are returned where parsing failed. We can use these to view what wasn’t processed and why.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># View data that wasn't parsed</span>

x[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/NA">is.na</a></span>(x_cnv)]
<span class="co">#&gt;  [1] "5/16/12 1"     "5/16/12 2"     "5/16/12 3"     "5/16/12 4"    </span>
<span class="co">#&gt;  [5] "5/16/12 5"     "16/5/12 10:00" "16/5/12 11:00" "16/5/12 12:00"</span>
<span class="co">#&gt;  [9] "16/5/12 13:00" "16/5/12 14:00" "16/5/12 15:00" "16/5/12 16:00"</span>
<span class="co">#&gt; [13] "16/5/12 17:00" "16/5/12 18:00" "16/5/12 19:00"</span>

<span class="co"># There are two orders present in these data, 'mdy H' and 'dmy HM'. Try converting with an updated list of orders.</span>

x_cnv &lt;-<span class="st"> </span><span class="kw"><a href="../reference/iso8601_convert.html">iso8601_convert</a></span>(x, <span class="dt">orders =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'mdy H'</span>, <span class="st">'mdy HM'</span>, <span class="st">'dmy HM'</span>))
x_cnv
<span class="co">#&gt;  [1] "2012-05-15T13:00" "2012-05-15T14:00" "2012-05-15T15:00"</span>
<span class="co">#&gt;  [4] "2012-05-15T16:00" "2012-05-15T17:00" "2012-05-15T18:00"</span>
<span class="co">#&gt;  [7] "2012-05-15T19:00" "2012-05-15T20:00" "2012-05-15T21:00"</span>
<span class="co">#&gt; [10] "2012-05-15T22:00" "2012-05-15T23:00" "2012-05-16T00:00"</span>
<span class="co">#&gt; [13] "2012-05-16T01"    "2012-05-16T02"    "2012-05-16T03"   </span>
<span class="co">#&gt; [16] "2012-05-16T04"    "2012-05-16T05"    "2012-05-16T06:00"</span>
<span class="co">#&gt; [19] "2012-05-16T07:00" "2012-05-16T08:00" "2012-05-16T09:00"</span>
<span class="co">#&gt; [22] "2012-05-16T10:00" "2012-05-16T11:00" "2012-05-16T12:00"</span>
<span class="co">#&gt; [25] "2012-05-16T13:00" "2012-05-16T14:00" "2012-05-16T15:00"</span>
<span class="co">#&gt; [28] "2012-05-16T16:00" "2012-05-16T17:00" "2012-05-16T18:00"</span>
<span class="co">#&gt; [31] "2012-05-16T19:00"</span></code></pre></div>
<p>Notice, all the dates and times were parsed and output in resolution of the input data. Suppose we want to force the output resolution to be equal across all records. To do this, set the orders to the same resolution and set the <code>truncated</code> argument to the number of missing formats.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Adjust arguments to output data in the same resolution.</span>

x_cnv &lt;-<span class="st"> </span><span class="kw"><a href="../reference/iso8601_convert.html">iso8601_convert</a></span>(x, <span class="dt">orders =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'mdy HM'</span>, <span class="st">'mdy HM'</span>, <span class="st">'dmy HM'</span>), <span class="dt">truncated =</span> <span class="dv">1</span>)
x_cnv
<span class="co">#&gt;  [1] "2012-05-15T13:00" "2012-05-15T14:00" "2012-05-15T15:00"</span>
<span class="co">#&gt;  [4] "2012-05-15T16:00" "2012-05-15T17:00" "2012-05-15T18:00"</span>
<span class="co">#&gt;  [7] "2012-05-15T19:00" "2012-05-15T20:00" "2012-05-15T21:00"</span>
<span class="co">#&gt; [10] "2012-05-15T22:00" "2012-05-15T23:00" "2012-05-16T00:00"</span>
<span class="co">#&gt; [13] "2012-05-16T01:00" "2012-05-16T02:00" "2012-05-16T03:00"</span>
<span class="co">#&gt; [16] "2012-05-16T04:00" "2012-05-16T05:00" "2012-05-16T06:00"</span>
<span class="co">#&gt; [19] "2012-05-16T07:00" "2012-05-16T08:00" "2012-05-16T09:00"</span>
<span class="co">#&gt; [22] "2012-05-16T10:00" "2012-05-16T11:00" "2012-05-16T12:00"</span>
<span class="co">#&gt; [25] "2012-05-16T13:00" "2012-05-16T14:00" "2012-05-16T15:00"</span>
<span class="co">#&gt; [28] "2012-05-16T16:00" "2012-05-16T17:00" "2012-05-16T18:00"</span>
<span class="co">#&gt; [31] "2012-05-16T19:00"</span></code></pre></div>
<p>Time zone offsets are added as a two digit hour with a ‘+’ or ‘-’ with respect to UTC.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Add a time zone offset</span>

x_cnv &lt;-<span class="st"> </span><span class="kw"><a href="../reference/iso8601_convert.html">iso8601_convert</a></span>(x, <span class="dt">orders =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'mdy HM'</span>, <span class="st">'mdy HM'</span>, <span class="st">'dmy HM'</span>), <span class="dt">truncated =</span> <span class="dv">1</span>, <span class="dt">tz =</span> <span class="st">'-05'</span>)
x_cnv
<span class="co">#&gt;  [1] "2012-05-15T13:00-05" "2012-05-15T14:00-05" "2012-05-15T15:00-05"</span>
<span class="co">#&gt;  [4] "2012-05-15T16:00-05" "2012-05-15T17:00-05" "2012-05-15T18:00-05"</span>
<span class="co">#&gt;  [7] "2012-05-15T19:00-05" "2012-05-15T20:00-05" "2012-05-15T21:00-05"</span>
<span class="co">#&gt; [10] "2012-05-15T22:00-05" "2012-05-15T23:00-05" "2012-05-16T00:00-05"</span>
<span class="co">#&gt; [13] "2012-05-16T01:00-05" "2012-05-16T02:00-05" "2012-05-16T03:00-05"</span>
<span class="co">#&gt; [16] "2012-05-16T04:00-05" "2012-05-16T05:00-05" "2012-05-16T06:00-05"</span>
<span class="co">#&gt; [19] "2012-05-16T07:00-05" "2012-05-16T08:00-05" "2012-05-16T09:00-05"</span>
<span class="co">#&gt; [22] "2012-05-16T10:00-05" "2012-05-16T11:00-05" "2012-05-16T12:00-05"</span>
<span class="co">#&gt; [25] "2012-05-16T13:00-05" "2012-05-16T14:00-05" "2012-05-16T15:00-05"</span>
<span class="co">#&gt; [28] "2012-05-16T16:00-05" "2012-05-16T17:00-05" "2012-05-16T18:00-05"</span>
<span class="co">#&gt; [31] "2012-05-16T19:00-05"</span></code></pre></div>
<p>Voila! Dates and times in an ISO 8601 standard format.</p>
</div>
<div id="get-the-datetime-format-string" class="section level2">
<h2 class="hasAnchor">
<a href="#get-the-datetime-format-string" class="anchor"></a>Get the datetime format string</h2>
<p>Another common data management task is to identify and report the format string specifier (e.g. ‘YYYY-MM-DD’) for a vector of date and time data. While not particularly difficult to do, automating this task can improve workflow efficiency and accuracy.</p>
<p><code>iso8601_get_format_string</code> uses regular expressions to parse input data and identify the format string(s) present in a set of ISO 8601 dates and times in the format output by <code>iso8601_convert</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get the format string of the processed date and time data</span>

<span class="kw"><a href="../reference/iso8601_get_format_string.html">iso8601_get_format_string</a></span>(x_cnv)
<span class="co">#&gt; [1] "YYYY-MM-DDThh:mm-hh"</span>

<span class="co"># If there were more than one date time format present, then the mode is returned with a warning message.</span>

x_different_formats &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'2012-05-15T13:45:00'</span>, <span class="st">'2012-06-15T13:45:00'</span>, <span class="st">'2012-07-15T13:45:00'</span>, <span class="st">'2012-08-15T13:45'</span>, <span class="st">'2012-09-15T13:45'</span>, <span class="st">'2012-10-15T13'</span>)

<span class="kw"><a href="../reference/iso8601_get_format_string.html">iso8601_get_format_string</a></span>(x_different_formats)
<span class="co">#&gt; Warning in iso8601_get_format_string(x_different_formats): More than one</span>
<span class="co">#&gt; date and time format was found. The returned value is the mode of the</span>
<span class="co">#&gt; detected formats.</span>
<span class="co">#&gt; [1] "YYYY-MM-DDThh:mm:ss"</span></code></pre></div>
</div>
<div id="reading-into-posixct-posixt" class="section level2">
<h2 class="hasAnchor">
<a href="#reading-into-posixct-posixt" class="anchor"></a>Reading into POSIXct POSIXt</h2>
<p><code>iso8601_read</code> provides a lightweight option for reading ISO 8601 data in the POSIXct POXIXt class. This function uses regular expressions to extract the orders and time zone offset arguments and then passess the info to <code><a href="http://lubridate.tidyverse.org/reference/parse_date_time.html">lubridate::parse_date_time</a></code> for parsing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Read data into POSIXct POSIXt</span>

<span class="co"># Read data into R</span>
x_pos &lt;-<span class="st"> </span><span class="kw"><a href="../reference/iso8601_read.html">iso8601_read</a></span>(x_cnv)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/attributes">attributes</a></span>(x_pos)
<span class="co">#&gt; $class</span>
<span class="co">#&gt; [1] "POSIXct" "POSIXt" </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $tzone</span>
<span class="co">#&gt; [1] "Etc/GMT-5"</span></code></pre></div>
<p>Now that the data are in POSIX, the myriad of date and time functions of <code>lubridate</code> are available to you.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#conversion">Conversion</a></li>
      <li><a href="#get-the-datetime-format-string">Get the datetime format string</a></li>
      <li><a href="#reading-into-posixct-posixt">Reading into POSIXct POSIXt</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Colin Smith.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
